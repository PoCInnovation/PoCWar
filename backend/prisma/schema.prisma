datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Lang {
  c
  cpp
  go
  javascript
  python
  rust
  ruby
}

enum Role {
    user
    admin
}

model User {
  id          Int          @default(autoincrement()) @id
  role        Role
  name        String
  email       String       @unique
  password    String
  challenges  Challenge[]
  codeSources CodeSource[]
}

model Challenge {
  id          Int          @default(autoincrement()) @id
  name        String
  slug        String       @unique
  tests       Test[]
  codeSources CodeSource[]
  author      User         @relation(fields: [authorId], references: [id])
  authorId    Int
}

model Test {
  id          Int       @default(autoincrement()) @id
  name        String
  out         String
  err         String
  ret         Int
  args        String
  challenge   Challenge @relation(fields: [challengeId], references: [id])
  challengeId Int
}

model CodeSource {
  lang        Lang
  code        String
  challenge   Challenge @relation(fields: [challengeId], references: [id])
  challengeId Int
  author      User      @relation(fields: [authorId], references: [id])
  authorId    Int
  lastResult  String?
  passAllTest Bool      @default(false)

  @@unique([authorId, challengeId], name: "ux_codesource_author_challenge")
}